# Calendar 기능 테스트 가이드

## 개요

캘린더 다중 지원 기능의 테스트 시나리오 및 체크리스트입니다.

**작성일**: 2026-01-19
**대상 기능**: Phase C-1 ~ C-5 (캘린더 다중 지원 MVP)

---

## 사전 준비

### 1. Google Calendar 설정

테스트를 위해 Google Calendar에서 다음을 준비하세요:

1. **Primary 캘린더에 일정 추가**
   - 종일 일정 1개 (예: "설날 연휴")
   - 시간 지정 일정 2개 (예: "09:00-10:00 팀 미팅", "14:00-15:00 고객 미팅")
   - 위치 정보 포함 일정 1개
   - Google Meet 링크 포함 일정 1개
   - 참석자 포함 일정 1개

2. **추가 캘린더 생성** (선택)
   - "Work" 캘린더 생성
   - "개인" 캘린더 생성
   - 각 캘린더에 일정 1-2개 추가

### 2. 알림 채널 연동

- 카카오톡 또는 텔레그램 중 최소 1개 연동
- 알림 수신 가능한 상태 확인

---

## Phase C-1: 캘린더 목록 조회

### 테스트 시나리오

1. **캘린더 목록 조회**
   - [ ] `/calendar` 페이지 접속
   - [ ] "캘린더 선택" 섹션에 캘린더 목록 표시 확인
   - [ ] Primary 캘린더에 "Primary" 배지 표시 확인
   - [ ] 각 캘린더별 색상 표시 확인 (왼쪽 테두리)
   - [ ] 접근 권한 배지 표시 확인 (owner/writer/reader)

2. **API 엔드포인트 테스트**
   ```bash
   # 캘린더 목록 조회
   curl http://localhost:8000/api/calendar/list \
     -H "Cookie: session=..." \
     -X GET
   ```
   - [ ] 응답에 `calendars` 배열 포함
   - [ ] 각 캘린더에 `id`, `summary`, `backgroundColor`, `primary`, `accessRole` 포함

### 예상 결과

```json
{
  "calendars": [
    {
      "id": "primary",
      "summary": "홍길동",
      "backgroundColor": "#9fc6e7",
      "foregroundColor": "#000000",
      "primary": true,
      "accessRole": "owner"
    },
    {
      "id": "abc123@group.calendar.google.com",
      "summary": "Work",
      "backgroundColor": "#0b8043",
      "foregroundColor": "#ffffff",
      "primary": false,
      "accessRole": "owner"
    }
  ],
  "count": 2
}
```

---

## Phase C-2: 캘린더 선택 저장

### 테스트 시나리오

1. **캘린더 선택**
   - [ ] Primary 캘린더 체크
   - [ ] 추가 캘린더 1개 체크
   - [ ] "선택 저장" 버튼 클릭
   - [ ] 성공 토스트 메시지 확인

2. **선택 복원**
   - [ ] 페이지 새로고침
   - [ ] 이전에 선택한 캘린더가 체크된 상태로 로드되는지 확인

3. **API 엔드포인트 테스트**
   ```bash
   # 캘린더 선택 저장
   curl http://localhost:8000/api/calendar/select \
     -H "Cookie: session=..." \
     -H "Content-Type: application/json" \
     -X POST \
     -d '{
       "calendars": [
         {"id": "primary", "name": "홍길동", "color": "#9fc6e7"},
         {"id": "abc123@group.calendar.google.com", "name": "Work", "color": "#0b8043"}
       ]
     }'

   # 선택된 캘린더 조회
   curl http://localhost:8000/api/calendar/selected \
     -H "Cookie: session=..." \
     -X GET
   ```

4. **최소 선택 검증**
   - [ ] 모든 체크박스 해제
   - [ ] "선택 저장" 버튼 클릭
   - [ ] 경고 메시지 확인: "최소 1개 이상의 캘린더를 선택해주세요"

---

## Phase C-3: 다중 캘린더 일정 조회

### 테스트 시나리오

1. **단일 캘린더 (Primary만 선택)**
   - [ ] Primary 캘린더만 선택
   - [ ] "오늘 일정 미리보기" 버튼 클릭
   - [ ] 기존 형식으로 일정 표시 확인 ([ 종일 일정 ], [ 시간 일정 ])

2. **다중 캘린더 선택**
   - [ ] Primary + Work 캘린더 선택
   - [ ] "오늘 일정 미리보기" 버튼 클릭
   - [ ] 캘린더별로 그룹화된 형식 확인
   - [ ] 각 캘린더 이름이 섹션 헤더로 표시되는지 확인
   - [ ] 하단 요약 확인 (예: "총 5개의 일정 (2개 캘린더)")

3. **알림 발송 테스트**
   - [ ] "즉시 테스트 발송" 버튼 클릭
   - [ ] 카카오톡/텔레그램에서 알림 수신 확인
   - [ ] 선택한 캘린더의 일정만 포함되었는지 확인

### 예상 메시지 형식 (다중 캘린더)

```
[오늘의 일정] 2026년 01월 19일 (일)

[ 홍길동 ]
- 09:00~10:00 | 운동
  📍 헬스장

[ Work ]
- 14:00~15:00 | 팀 미팅
  🔗 https://meet.google.com/abc-defg-hij
  👥 김팀장, 이대리

- (종일) 프로젝트 마감일

총 3개의 일정 (2개 캘린더)
```

---

## Phase C-4: 알림 메시지 개선

### 테스트 시나리오

1. **위치 정보 표시**
   - [ ] 위치가 포함된 일정 생성
   - [ ] 미리보기에서 📍 이모지와 함께 위치 표시 확인
   - [ ] 알림 메시지에 위치 포함 확인

2. **화상회의 링크 표시**
   - [ ] Google Meet 링크가 포함된 일정 생성
   - [ ] 미리보기에서 🔗 이모지와 함께 링크 표시 확인
   - [ ] 실제 링크 URL 표시 확인

3. **참석자 정보 표시**
   - [ ] 참석자가 포함된 일정 생성 (3명)
   - [ ] 미리보기에서 👥 이모지와 함께 참석자 이름 표시 확인
   - [ ] 참석자 4명 이상인 경우 "외 N명" 표시 확인

4. **요일 표시**
   - [ ] 메시지 헤더에 요일 표시 확인 (예: "2026년 01월 19일 (일)")

### 테스트 케이스

| 일정 유형 | 표시 내용 | 확인 |
|----------|----------|------|
| 위치만 있음 | 📍 회의실 A | [ ] |
| Meet 링크만 있음 | 🔗 https://meet.google.com/... | [ ] |
| 참석자 3명 | 👥 홍길동, 김철수, 이영희 | [ ] |
| 참석자 5명 | 👥 홍길동, 김철수, 이영희 외 2명 | [ ] |
| 위치+Meet+참석자 | 3줄 모두 표시 | [ ] |

---

## Phase C-5: UI 개선

### 테스트 시나리오

1. **캘린더 목록 UI**
   - [ ] 캘린더 색상이 왼쪽 테두리에 표시되는지 확인
   - [ ] Primary 배지가 Primary 캘린더에만 표시되는지 확인
   - [ ] 접근 권한 배지 색상 확인 (캘린더 배경색)
   - [ ] 캘린더 설명이 있는 경우 표시 확인

2. **체크박스 동작**
   - [ ] 캘린더 체크/해제 정상 동작
   - [ ] 레이블 클릭 시 체크박스 토글
   - [ ] 선택된 상태가 시각적으로 명확한지 확인

3. **새로고침 버튼**
   - [ ] "새로고침" 버튼 클릭
   - [ ] 로딩 스피너 표시 확인
   - [ ] 캘린더 목록 재로드 확인

4. **반응형 UI**
   - [ ] 화면 크기 조절 시 캘린더 카드가 2열로 표시되는지 확인
   - [ ] 모바일 화면에서 1열로 표시되는지 확인

---

## 통합 테스트

### 시나리오 1: 신규 사용자

1. [ ] Google 계정 연동
2. [ ] 캘린더 목록 자동 로드 확인
3. [ ] 캘린더 선택 (Primary + Work)
4. [ ] 선택 저장
5. [ ] 알림 시간 설정 (예: 08:00)
6. [ ] 설정 저장
7. [ ] 즉시 테스트 발송
8. [ ] 알림 수신 확인

### 시나리오 2: 기존 사용자 (캘린더 추가)

1. [ ] 기존 선택된 캘린더 확인
2. [ ] Google Calendar에서 새 캘린더 생성
3. [ ] 페이지에서 "새로고침" 버튼 클릭
4. [ ] 새 캘린더가 목록에 표시되는지 확인
5. [ ] 새 캘린더 선택 추가
6. [ ] 저장 후 알림에 포함되는지 확인

### 시나리오 3: 캘린더 선택 해제

1. [ ] 기존 선택된 캘린더 확인
2. [ ] 일부 캘린더 체크 해제
3. [ ] 저장
4. [ ] 알림에서 해제한 캘린더 일정이 제외되는지 확인

### 시나리오 4: Google 연동 해제 후 재연동

1. [ ] Settings 페이지에서 Google 연동 해제
2. [ ] Calendar 페이지에서 "Google 로그인" 버튼 표시 확인
3. [ ] Google 재연동
4. [ ] 캘린더 목록 자동 로드 확인
5. [ ] 이전 선택 상태가 유지되는지 확인 (DB에 저장된 상태)

---

## 에러 처리 테스트

### 1. Google 연동 없음

- [ ] Google 연동하지 않은 상태에서 Calendar 페이지 접속
- [ ] "Google 계정 연동이 필요합니다" 경고 메시지 표시 확인
- [ ] "Google 로그인" 버튼 표시 확인

### 2. 토큰 만료

- [ ] Google 토큰 만료 시뮬레이션 (수동으로 DB의 expiry 날짜 변경)
- [ ] 일정 미리보기 클릭
- [ ] 자동 토큰 갱신 확인
- [ ] 정상적으로 일정 표시 확인

### 3. 네트워크 오류

- [ ] 네트워크 연결 끊기
- [ ] 캘린더 목록 로드 시도
- [ ] 에러 메시지 표시 확인

### 4. 빈 캘린더 목록

- [ ] 모든 Google Calendar 삭제 (테스트 계정)
- [ ] 캘린더 목록 조회
- [ ] 적절한 안내 메시지 표시 확인

---

## 성능 테스트

### 1. 다중 캘린더 조회 성능

- [ ] 5개 캘린더 선택
- [ ] 각 캘린더에 일정 10개씩 추가
- [ ] 일정 미리보기 로드 시간 측정 (3초 이내 권장)
- [ ] 알림 발송 성공 확인

### 2. 메시지 길이 제한

- [ ] 10개 이상의 일정 생성
- [ ] 알림 메시지 길이 확인
- [ ] 카카오톡: 2,000자 이내 (초과 시 메시지 잘림)
- [ ] 텔레그램: 4,096자 이내

---

## 로그 검증

### 확인 항목

1. [ ] 최근 로그 섹션에 캘린더 알림 로그 표시
2. [ ] 성공 로그: "SUCCESS" 배지, 일정 개수 포함
3. [ ] 실패 로그: "FAIL" 배지, 에러 메시지 포함
4. [ ] 로그 시간 정확성 확인

### 로그 예시

```
SUCCESS  2026-01-19 08:00:15
캘린더 알림 발송 성공 - 5개 일정 (카카오톡, 텔레그램)

FAIL  2026-01-19 07:55:23
Google 토큰이 없습니다
```

---

## 회귀 테스트 (기존 기능)

### 1. 알림 시간 설정

- [ ] 알림 시간 변경
- [ ] 설정 저장
- [ ] 다음 발송 예정 시간 업데이트 확인

### 2. 활성화/비활성화 토글

- [ ] 캘린더 알림 비활성화
- [ ] 상태 "Inactive" 표시 확인
- [ ] 다시 활성화
- [ ] 상태 "Active" 표시 확인

### 3. Settings 페이지 연동

- [ ] Settings 페이지에서 캘린더 알림 설정 변경
- [ ] Calendar 페이지에서 반영 확인

---

## 체크리스트 요약

### Phase C-1: 캘린더 목록 조회
- [x] 캘린더 목록 API 동작
- [x] UI에 목록 표시
- [x] 색상/배지 표시

### Phase C-2: 캘린더 선택 저장
- [x] 선택 저장 API 동작
- [x] 선택 복원 기능
- [x] 최소 선택 검증

### Phase C-3: 다중 캘린더 일정 조회
- [x] 단일 캘린더 조회
- [x] 다중 캘린더 조회
- [x] 캘린더별 그룹화

### Phase C-4: 알림 메시지 개선
- [x] 위치 정보 표시
- [x] 화상회의 링크 표시
- [x] 참석자 정보 표시
- [x] 요일 표시

### Phase C-5: UI 개선
- [x] 캘린더 선택 UI
- [x] 색상 표시
- [x] 체크박스 동작
- [x] 새로고침 기능

---

## 알려진 이슈 및 제한사항

1. **메시지 길이 제한**
   - 카카오톡: 2,000자 제한
   - 다중 캘린더 사용 시 일정이 많으면 메시지가 잘릴 수 있음
   - 권장: 캘린더 5개 이하, 일정 10개 이하

2. **API 호출 제한**
   - Google Calendar API: 1,000,000 요청/일
   - 개인 사용 시 문제 없음

3. **토큰 갱신**
   - Google 토큰은 1시간마다 만료
   - 자동 갱신 로직 구현됨

4. **캘린더 삭제**
   - Google에서 캘린더 삭제 시 선택 목록에서 자동 제거되지 않음
   - 수동으로 선택 해제 필요

---

## 테스트 완료 후 확인사항

- [ ] 모든 테스트 시나리오 통과
- [ ] 에러 처리 정상 동작
- [ ] 로그 정확성 확인
- [ ] 기존 기능 회귀 테스트 통과
- [ ] 문서 업데이트 (calendarplan.md)

**테스트 완료일**: ___________
**테스터**: ___________
**결과**: PASS / FAIL
